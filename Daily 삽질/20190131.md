# RDB로 계층화된 JSON 만들기
나는 가상화 호스트의 정보와, 그 위에 올라가 있는 가상 서버들의 정보를 트리 구조로 화면에 보여줘야 하는 과제를 받았다.
하나의 호스트의 정보와 그 위에 올라가 있는 vm 리스트를, 각각의 상세정보(hostname, ip...)와 함께 화면에 넘겨줘야 했다.
즉 나의 생각으로는 다음과 같은 json이 화면으로 전달되어야 했다.
```
hostname: XX
power_state: YY
operating_system: ZZ
...
guests: 
    {hostname: XX
    power_state: YY
    operating_system: ZZ
    ...},
    {hostname: XX
    power_state: YY
    operating_system: ZZ
    ...}
```
이걸 DB로 치환해서 생각해보면 한 칼럼 안에 또 다른 테이블이 들어가 있는 구조라, DB 자체에서 저 형태로 꺼내기는 어려울 거라고 DBA 님께서 말씀해주셨다.
...?! 그럼 도대체 어떻게 해야 하지?
팀원들의 조언을 받았다.

가상화 호스트가 아닌 일반 베어메탈 서버들도 있기 때문에, 기본 정보를 가지고 오는 형태를 바꿀 수는 없었다.
그래서 이 자료 구조는 유지를 하고, 대신 가상화 호스트인 것들만 따로 뽑아서 그 서버 id를 기준으로 vm을 검색하도록 했다.
즉, **일반 객체 리스트 하나와 Map 하나**가 화면에 json 형태로 전달되어야 했다.

map도 객체 리스트 넘기듯이 똑같이 JSONObject를 통해 넘길 수 있을 줄 알았는데 아니었다..!
그래서 `gson` 라이브러리의 도움을 받아서 깔끔하게 넘겼다.


그렇지만 이것은 고생의 서막에 불과했다.